doctype html
html
  head
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width')
    title Список пользователей
    link(href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css', rel='stylesheet')
    script(src='https://code.jquery.com/jquery-2.2.4.min.js')
    style.
      body{
        margin: 0 10px;
      }
      .act {
      border: solid;
      }
      div.info p{
      float: left;
      }
      div.info {
      margin: 10px 5px;
      padding: 5px 3px;
      }
      div.info button{
      margin:0 3px;
      }
      div.info:nth-of-type(even) {
      background-color: #EEEEEE;
      }
      div.info:nth-of-type(odd) {
      background-color:rgb(201, 197, 197);
      }
      .left{
      float: left;
      }
      .right{
      float: right;
      }
      .mainBloc{
      width: 60%;
      border-right: 1px solid rgb(25, 140, 223);
      height: 100vh;
      }
      .form-group{
      width: 95%;
      }
      .sideBloc{
      width: 40%;
      text-align: center;
      }
      .hid{
      display: none;
      }
  body
    .left.mainBloc
      a(href='/signout', class='text-center new-account') Sign Out
      h2 Список пользователей
      form#Form(name='userForm')
        .form-group
          label(for='name') Имя:
          input.form-control(type='text', autocomplete='off', name='name')
        .form-group
          label(for='age') Возраст:
          input.form-control(type='number', autocomplete='off', name='age')
        .clubs
          input#PugAbbey(type='radio', name='clubs', value='Pug Abbey', checked='')
          label Pug Abbey
          br
          input#CorgiAbbey(type='radio', name='clubs', value='Corgi Abbey')
          label Corgi Abbey
          br
        .panel-body
          button#SaveButton.btn.btn-sm.btn-primary(onclick='CreateUser()', type='button') Сохранить
          button.btn.btn-sm.btn-primary(onclick='reset()', type='button') Сбросить Форму
      .list
    .left.sideBloc
      form(name='clubs', onchange='ClubsOnChange()')
        input#PugAbbey(type='radio', name='ShowClubs', value='Pug')
        label Pug Abbey
        input#CorgiAbbey(type='radio', name='ShowClubs', value='Corgi')
        label Corgi Abbey
        br
      .SideList
        .Pug.Club.hid
          .PugClubInfo
            p Информация клуба Мопсов
          .PugList
        .Corgi.Club.hid
          .CorgiClubInfo
            p Информация клуба Корги
          .CorgiList
    script.
      function ClubsOnChange(){
      let club = document.querySelector('input[name="ShowClubs"]:checked');
      let trash = document.querySelectorAll('div.Club:not(.hid)');
      if(trash.length>0) trash.forEach( el => el.classList.add('hid') );
      if(club){
      document.querySelector('.' + club.value).classList.remove('hid');
      }
      }
      // Получение всех пользователей
      (function GetUsers() {
      let req = new XMLHttpRequest();
      req.open('GET', '/api/users', true);
      req.onreadystatechange = function (aEvt) {
      if (req.readyState == 4) {
      if(req.status == 200){
      JSON.parse(req.responseText).forEach(el => {
      AddText(el.name + '  ' + el.age + ' ' + el.titleClub, el._id, 'list');
      AddText(el.name + '  ' + el.age + ' ' + el.titleClub, el._id, el.titleClub.split(' ')[0] +'List');
      });
      }
      else console.log("Error loading page\\n");
      }
      };
      req.send(null);
      })();
      //Получить юзера
      function GetUser() {
      let id = this.parentElement.id;
      id = id.split('-')[1];
      let req = new XMLHttpRequest();
      req.open('GET', '/api/users/'+id, true);
      req.onreadystatechange = function (aEvt) {
      if (req.readyState == 4) {
      if(req.status == 200){
      let form = document.forms["userForm"];
      let data = JSON.parse(req.responseText);
      form.elements["name"].value = data.name;
      form.elements["age"].value = data.age;
      document.getElementById(data.titleClub.split(' ').join('')).checked = true;
      let arr = document.querySelectorAll('#DATA-'+data._id);
      let flag;
      if(arr.length) arr.forEach( function(el){ flag = el.classList.toggle('act')})
      if(!flag){
      reset();
      document.getElementById('SaveButton').onclick = CreateUser;
      }else {
      document.getElementById('SaveButton').onclick = EditUser;
      }
      let trash = document.querySelectorAll('.act:not(#DATA-'+data._id+')');
      if(trash.length) trash.forEach( el=>el.classList.remove('act'));
      }
      else
      console.log("Error loading page\\n");
      }
      };
      req.send(null);
      }
      // Добавление пользователя
      function CreateUser() {
      let form = document.forms["userForm"] ;
      let name = form.elements["name"].value || 'ЗабылУказатьИмя' ;
      let age = form.elements["age"].value || '000';
      let club = document.querySelector('input[name="clubs"]:checked').value;
      if(name !== '' && age !== '') {
      let xhr = new XMLHttpRequest();
      xhr.open("POST", 'api/users', true);
      xhr.setRequestHeader('Content-type', 'application/json');
      xhr.send(JSON.stringify({
      name: name,
      age: age,
      club : club
      }));
      xhr.onreadystatechange = function () {
      if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200){
      let el = JSON.parse(xhr.responseText);
      AddText(el.name + '  ' + el.age + ' ' + el.titleClub, el._id, 'list');
      AddText(el.name + '  ' + el.age + ' ' + el.titleClub, el._id, el.titleClub.split(' ')[0] +'List');
      reset();
      }
      }
      }else console.log("Необходимо заполнить поля !");
      }
      // Изменение пользователя
      function EditUser() {
      let form = document.forms["userForm"];
      let name = form.elements["name"].value;
      let age = form.elements["age"].value;
      let club = document.querySelector('input[name="clubs"]:checked').value;
      let id = document.querySelector('div.act').id.split('-')[1];
      if(name!=='' && age!==''){
      let xhr = new XMLHttpRequest();
      xhr.open("PUT", 'api/users', true);
      xhr.setRequestHeader('Content-type', 'application/json');
      xhr.send(JSON.stringify({
      id: id,
      name: name,
      age: age,
      club: club,
      }));
      xhr.onreadystatechange = function () {
      if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200){
      document.querySelector("div#DATA-" + id + ' p').innerHTML = name + " " + age + " " + club;
      document.querySelector( "div.Club div#DATA-" + id ).remove();
      AddText(name + " " + age + " " + club, id, club.split(' ')[0] +'List');
      document.querySelector( "div.Club div#DATA-" + id ).classList.add('act');
      }
      }
      }else console.log("Необходимо заполнить поля !");
      }
      // сброс формы
      function reset() {
      let form = document.forms["userForm"];
      form.reset();
      document.getElementById('SaveButton').onclick = CreateUser;
      }
      // Удаление пользователя
      function DeleteUser() {
      let id = this.parentElement.id
      id = id.split('-')[1];
      let req = new XMLHttpRequest();
      req.open('DELETE', '/api/users/'+id, true);
      req.setRequestHeader('Content-type', 'application/json');
      req.onreadystatechange = function () {
      if(req.readyState === XMLHttpRequest.DONE && req.status === 200){
      let trash = document.querySelectorAll("#DATA-" + id)
      if(trash[0].classList.contains('act')){
      document.getElementById('SaveButton').onclick = CreateUser;
      }
      trash.forEach( (el) => el.remove() );
      }
      }
      req.send(null);
      }
      function AddText(text, id, position){
      let div = document.createElement('div');
      div.id = "DATA-" + id;
      div.classList.add('info');
      let p = document.createElement('p');
      p.innerText = text;
      div.append(p);
      let AddButton = document.createElement('button');
      AddButton.onclick = GetUser;
      AddButton.classList.add('btn','btn-sm', 'btn-primary');
      AddButton.innerHTML = 'Изменить';
      div.append(AddButton);
      let DellButton = document.createElement('button');
      DellButton.onclick = DeleteUser;
      DellButton.classList.add('btn','btn-sm', 'btn-primary');
      DellButton.innerHTML = 'Удалить';
      div.append(DellButton);
      document.querySelector('.' + position).append(div);
      }
